---
layout: post
title: node 基础学习(三)
categories: 原创
tags: node
---

什么风把你吹来的，让我变成一个焕然一新的人

<!--more-->

今天发现要做后端，要了解通信，肯定也要懂`TPC`啊。瞬间觉得当年没有认真上课真的是悔恨啊。简单了解了一下`TCP`

### `TCP`

所谓的协议就是双方进行数据传输的一种格式。`TCP/IP`协议栈主要分为四层：应用层、传输层、网络层、数据链路层。

![TCP/IP协议栈分层](http://karynsong.github.io/static/img/tcp.png "TCP/IP协议栈分层")

> * TCP/IP 是供已连接因特网的计算机进行通信的通信协议。
> * TCP/IP 指传输控制协议/网际协议 (Transmission Control Protocol / Internet Protocol)。
> * TCP/IP 定义了电子设备（比如计算机）如何连入因特网，以及数据如何在它们之间传输的标准。

`Node HTTP`服务器构建字`Node TCP`，`http.server`继承字`net.server`。

### `TCP`特性

> * 面向连接的通信和保证顺序的传递
> * 面向字节
> * 可靠性
> * 流控制
> * 拥堵控制

### 聊天室

下面是基于`TCP`实现了一个简单的网络聊天室，只要在一个网段里，就可以相互发送一些消息。

    // 引入net模块
    var net = require('net');

    var count = 0,      // 用于统计加入聊天室的人数
        users = {};     // 统计聊天用户

    // 发送消息的方法
    function pushMessage(userName, message){
        for(var x in users){
            if(x !== userName){
                users[x].write(message);
            }
        }
    }

    // 创建一个net连接
    var server = net.createServer(function(connet){
        // 当前用户名
        var userName;
        // 设置字符类型
        connet.setEncoding('utf8');
        // 统计人数
        ++count;
        // 一些话
        connet.write('\033[91m 欢迎来到karyn聊天室 \033[39m \n');
        connet.write('\033[91m 目前聊天室中有' + count + '人 \033[39m \n');
        connet.write('\033[91m 请输入你的名字： \033[39m');
        // 监听输入的数据
        connet.on('data', function(data){
            // 去掉输入时的回车，这个是mac的回车
            data = data.replace('\r\n', '');
            // 默认第一次输入的是用户名
            if(!userName){
                // 用户名验证重复
                if(users[data]) {
                    connet.write('\033[91m 名字和聊天室中有重复，请重新命名 \033[39m \n');
                    return;
                }else{
                    // 给其他人发送消息
                    userName = data;
                    users[data] = connet;
                    pushMessage(userName, '\033[91m 欢迎' + userName + '加入聊天室 \033[39m \n')
                }
            }else{
                // 给其他人发送消息
                pushMessage(userName, '\033[91m ' + userName + ' ： \033[39m' + data + '\n');
            }
        });
        // 关闭聊天室
        connet.on('close', function(data){
            --count;
            delete users[userName]
        });
    });
    // 监听 2000 端口
    server.listen(2000, function(){
        console.log('\033[91m 正在监听2000端口 \033[39m');
    })
